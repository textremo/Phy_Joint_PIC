\documentclass{article}
\usepackage{hyperref}
\usepackage{url}
\usepackage{graphicx}
\usepackage{mathtools}  % math tools
\usepackage{caption}    % support subfigure
\usepackage{subcaption} % support subfigure
\usepackage{placeins}   % support FloatBarrier
\usepackage{listings}   % support codes
\usepackage{color}      % support color
\usepackage{amsmath} 	% support multiple lines
\usepackage{amsfonts,amssymb} % support holo characters
\usepackage[10pt]{extsizes}
%\documentstyle[nips14submit_09,times,art10]{article} % For LaTeX 2.09

% define color
\definecolor{darkred}{rgb}{0.6,0.0,0.0}
\definecolor{darkgreen}{rgb}{0,0.50,0}
\definecolor{lightblue}{rgb}{0.0,0.42,0.91}
\definecolor{orange}{rgb}{0.99,0.48,0.13}
\definecolor{grass}{rgb}{0.18,0.80,0.18}
\definecolor{pink}{rgb}{0.97,0.15,0.45}
% set the img folder
\graphicspath{{img/}}
% set math notations
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}




\renewcommand{\baselinestretch}{1.5}

\title{LMMSE}
\author{}
\date{}

\usepackage{geometry}
\geometry{a4paper,left=2cm,right=2cm,top=2cm,bottom=2cm}

\begin{document}

\maketitle
\section{LMMSE}
\subsection{MMSE $\to$ LMMSE}
\subsubsection{Mean}
The zero forcing estimation is
\begin{equation}
\hat{x} = R_xH^H(H^HR_xH + \sigma^2I)^{-1}H^Hy = R_x(H^HHR_x + \sigma^2I)^{-1}y
\end{equation}
The proof is given. Suppose $\hat{h}=Cy$, we can minimize
\begin{equation}
\begin{split}
J(C) &= E\{\norm{x - \hat{x}}^2 \} \\
&= E\{(x-Cy)^H(x-Cy)\} \\
&= E\{x^Hx - x^HCy - y^HC^Hx + y^HC^HCy \} \\
&= E\{tr(h^Hh) - tr(h^HCy) - tr(y^HC^Hh) + tr(y^HC^HCy) \} \\
\end{split}
\end{equation}
Therefore, we calculate the derivative,
\begin{equation}
\begin{split}
\frac{\partial J(C)}{\partial C} &= \frac{\partial tr(x^Hx)}{\partial C} - \frac{\partial tr(x^HCy)}{\partial C} - \frac{\partial tr(y^HC^Hx)}{\partial C} + \frac{\partial tr(y^HC^HCy)}{\partial C } = 0\\
&= 0 - x^*y^T - 0 + \frac{\partial tr(Cyy^HC^H)}{\partial C } \\
0 &= -x^*y^T + C^*(yy^H)^T \\
x^*y^T &= C^*(yy^H)^T \\
(xy^H)^* &= C^*(yy^H)^T \\
R_{xy}^* &= C^*R_{y}^T \\
\end{split}
\label{eq:mmse-lmmse-1}
\end{equation}
Here, $R_{y}$ is a Hermitian matrix, so $R_{y}^T = R_{y}^*$. \eqref{eq:mmse-lmmse-1} can be written as,
\begin{equation}
\begin{split}
R_{xy}^* &= C^*R_{y}^* \\
R_{xy} &= CR_{y} \\
C &= R_{xy}R_{y}^{-1} \\
\end{split}
\label{eq:mmse-lmmse-2}
\end{equation}
Here, 
\begin{equation}
\begin{split}
R_{xy} &= E\{xy^H\} = E\{ x(Hx + z)^H\} \\
&= E\{ xx^HH^H \} + E\{ xz^H \} \\
&= E\{ xx^H \}H^H \\
&= R_x H^H
\end{split}
\label{eq:mmse-lmmse-2:1}
\end{equation}
and,
\begin{equation}
\begin{split}
R_y &= E\{yy^H\} = E\{(Hx + z)(Hx + z)^H\} \\
&= E\{Hxx^HH^H\} + E\{zz^H\} \\
&= HR_xH^H + \sigma^2I  
\end{split}
\label{eq:mmse-lmmse-2:2}
\end{equation}
We load \eqref{eq:mmse-lmmse-2:1} and \eqref{eq:mmse-lmmse-2:2} into \eqref{eq:mmse-lmmse-2} to estimate symbols,
\begin{equation}
\begin{split}
\hat{x} &= Cy = R_{xy}R_{y}^{-1}y \\
&= R_x H^H (HR_xH^H + \sigma^2I )^{-1}y \\
&= R_x (H^HHR_x + \sigma^2I )^{-1} H^Hy 
\end{split}
\label{eq:mmse-lmmse-3}
\end{equation}
As with the result in \eqref{eq:mmse-lmmse-3},
\begin{equation}
\begin{split}
(H^HHR_x + \sigma^2I) H^H &= H^HHR_xH^H + \sigma^2IH^H \\ 
&= H^HHR_xH^H + H^H\sigma^2I \\
&= H^H(HR_xH^H + \sigma^2I) \\
(H^HHR_x + \sigma^2I)^{-1}(H^HHR_x + \sigma^2I) H^H &= (H^HHR_x + \sigma^2I)^{-1}H^H(HR_xH^H + \sigma^2I)\\
H^H &= (H^HHR_x + \sigma^2I)^{-1}H^H(HR_xH^H + \sigma^2I)\\
H^H(HR_xH^H + \sigma^2I)^{-1} &= (H^HHR_x + \sigma^2I)^{-1}H^H(HR_xH^H + \sigma^2I)(HR_xH^H + \sigma^2I)^{-1}\\
H^H(HR_xH^H + \sigma^2I)^{-1} &= (H^HHR_x + \sigma^2I)^{-1}H^H \\
R_xH^H(HR_xH^H + \sigma^2I)^{-1} &= R_x(H^HHR_x + \sigma^2I)^{-1}H^H
\end{split}
\label{eq:mmse-lmmse-4}
\end{equation}
If we estimate $R_x$ as a power of $x$, $R_x$ is a diagonal matrix with the power of $x$. \eqref{eq:mmse-lmmse-3} can be written as
\begin{equation}
\hat{x} = diag(P_x)\cdot (H^HH\cdot diag(P_x) + \sigma^2I )^{-1} H^Hy, 
\end{equation}
where $P_x = [P_{x_0}, P_{x_1}, \cdots P_{x_n}]$ is a vector of the signal power for each $x$.

\subsubsection{Variance}
The error of LMMSE is
\begin{equation}
\begin{split}
D_e &= E\{(\hat{x} - x)(\hat{x} - x)^H \}\\
&= E\{\hat{x}\hat{x}^H\} - E\{x\hat{x}^H\} - E\{\hat{x}x^H\} + E\{xx^H\} \\
\end{split}
\label{eq:mmse-lmmse-var-1}
\end{equation}
Please note that the error is orthogonal to the estimation (that is, the correlation matrix is all zero), i.e.,
\begin{equation}
\begin{split}
E\{e\hat{x}^H\} &= 0 \\
E\{(\hat{x} - x)\hat{x}^H\} &= 0 \\
E\{(\hat{x}\hat{x}^H\} - E\{x\hat{x}^H\} &= 0 \\
E\{\hat{x}\hat{x}^H\} &= E\{x\hat{x}^H\} \\
E\{(\hat{x}\hat{x}^H)^H\} &= E\{(x\hat{x}^H)^H\} \\
E\{\hat{x}\hat{x}^H\} &= E\{\hat{x}x^H\} \\
\end{split}
\label{eq:mmse-lmmse-var-2}
\end{equation}
We load \eqref{eq:mmse-lmmse-var-2} into \eqref{eq:mmse-lmmse-var-1},
\begin{equation}
\begin{split}
cov(\hat{x}) &= E\{\hat{x}\hat{x}^H\} - E\{\hat{x}\hat{x}^H\} - E\{\hat{x}\hat{x}^H\} + E\{xx^H\} \\
&= E\{xx^H\} - E\{\hat{x}\hat{x}^H\} \\
&= R_x - R_xH^HR_y^{-1}y y^H {R_y^{-1}}^HHR_x^H \\
&= R_x - R_xH^HR_y^{-1}R_yR_y^{-1}HR_x \\
&= R_x - R_xH^HR_y^{-1}HR_x \\
&= R_x - R_xH^H (HR_xH^H + \sigma^2I)^{-1} HR_x \\
&= R_x - R_x(H^HHR_x + \sigma^2I)^{-1}H^H HR_x \\
&= R_x(I - (H^HHR_x + \sigma^2I)^{-1}H^H HR_x) \\
&= R_x((H^HHR_x + \sigma^2I)^{-1}(H^HHR_x + \sigma^2I) - (H^HHR_x + \sigma^2I)^{-1}H^H HR_x) \\
&= R_x(H^HHR_x + \sigma^2I)^{-1}(H^HHR_x + \sigma^2I - H^H HR_x)\\
&= R_x(H^HHR_x + \sigma^2I)^{-1}\sigma^2I \\
&= \sigma^2R_x(H^HHR_x + \sigma^2I)^{-1}
\end{split}
\end{equation}
Therefore, the variance is
\begin{equation}
var(\hat{x}) = \sigma^2\cdot diag(R_x(H^HHR_x + \sigma^2I)^{-1})
\end{equation}


\subsection{Using the Estimated Channel Matrix}
If we use the estimated channel matrix $H$, the system model can be updated as
\begin{equation}
\begin{split}
y &= (\hat{H} + H - \hat{H})x + z \\
&= \hat{H}x + (H - \hat{H})x + z \\
&= \hat{H}x + \Delta Hx + z \\
&= \hat{H}x + \tilde{z}
\end{split}
\end{equation}
As $(H - \hat{H})x$ and $z$ are independent, the covariance of $\tilde{z}$ is
\begin{equation}
\begin{split}
cov(\tilde{z}) &= E\{\Delta Hx(\Delta Hx)^H \} + E\{zz^H\} \\
&= E\{\Delta Hxx^H\Delta H^H \} + \sigma^2I \\
&= 
\end{split}
\end{equation}

the error is
\begin{equation}
\begin{split}
e &= \hat{x} - x = Cy - x \\
&= C(\hat{H}x + z + Hx - \hat{H}x) - x\\
&= C(\hat{H}x + z) + C(H - \hat{H})x \\
&= \hat{x} + C(H - \hat{H})x
\end{split}
\label{eq:uecm-1}
\end{equation}

\end{document}
